<div class="container pt-3 table-responsive">

  <%= form_with url: products_path, method: :get, class: "form-inline w-100 mb-3" do |form| %>

    <div class="input-group">
      <%= form.text_field :query, class: "form-control", type: "search", placeholder: "Search", aria: { label: 'Name' }, value: params[:query] %>
      <%= form.submit "Search", class: "btn btn-primary", type: "submit" %>
    </div>

    <h3 class="my-3">Search Filter</h3>

    <div class="row">

      <div class="col-6">

        <h4 class="my-2">Quantity</h4>

        <div class="row">

          <div class="col-3">
            <div class="form-floating">
              <%= form.number_field :quantity_min, id: "quantity_min", class: "form-control", placeholder: "Min", value: params[:quantity_min] %>
              <%= form.label :quantity_min, "Min" %>
            </div>
          </div>

          <div class="col-3">
            <div class="form-floating">
              <%= form.number_field :quantity_max, id: "quantity_max", class: "form-control", placeholder: "Max", value: params[:quantity_max] %>
              <%= form.label :quantity_max, "Max" %>
            </div>
          </div>

        </div>

      </div>

      <div class="col-6">

        <h4 class="my-2">Price</h4>

        <div class="row mb-3">
          <div class="col-3">
            <div class="form-floating">
              <%= form.number_field :price_min, id: "price_min", class: "form-control", placeholder: "Min", value: params[:price_min] %>
              <%= form.label :price_min, "Min" %>
            </div>
          </div>

          <div class="col-3">
            <div class="form-floating">
              <%= form.number_field :price_max, id: "price_max", class: "form-control", placeholder: "Max", value: params[:price_max] %>
              <%= form.label :price_max, "Max" %>
            </div>
          </div>

        </div>

      </div>

    </div>

    <div class="row">
      <div class="col">
        <h4 class="my-2">Released Date</h4>

        <div class="row">

          <div class="col">
            <div class="form-floating">
              <%= form.date_field :released_at_start, class: "form-control", placeholder: "Start Date", value: params[:released_at_start] %>
              <%= form.label :released_at_start, "Start" %>
            </div>
          </div>

          <div class="col">
            <div class="form-floating">
              <%= form.date_field :released_at_end, class: "form-control", placeholder: "End Date", value: params[:released_at_end] %>
              <%= form.label :released_at_end, "End" %>
            </div>
          </div>

        </div>

      </div>

      <div class="col">
        <h4 class="my-2">Availability</h4>

        <%= form.radio_button :available, true, checked: (!params[:available].present? && !params[:available].present? || params[:available] == "true") %>
        <%= form.label :available_true, "Available", class: "me-3" %>
        <%= form.radio_button :available, false, checked: (params[:available].present? && params[:available] == "false") %>
        <%= form.label :available_false, "Unavailable" %>
      </div>

    </div>

  <% end %>

  <h1>All Products</h1>

  <%= link_to 'Create Product', new_product_path(@product), class: 'btn btn-sm btn-success', type: 'button' %>

  <table class="table table-striped table-bordered mt-2">
    <thead>
    <tr>
      <td>Name</td>
      <td>Content</td>
      <td>Image</td>
      <td>Quantity</td>
      <td>Price</td>
      <td>Available</td>
      <td>Released</td>
      <td>Discount</td>
      <td>Created At</td>
      <td>Actions</td>
    </tr>
    </thead>
    <tbody>
    <% @products.each do |product| %>
      <tr>
        <td class="text-nowrap"><%= product.name %></td>
        <td style="word-wrap: break-word;min-width: 160px;max-width: 160px;"><%= product.content %></td>
        <td class="text-nowrap"><%= image_tag(product.image.url, alt: "#{product.name} image", style: 'width: 80px; height: 80px;', class: 'rounded') if product.image.present? %></td>
        <td class="text-center"><%= product.quantity %></td>
        <td class="text-right"><%= product.price %></td>
        <td><%= product.available %></td>
        <td class="text-nowrap"><%= product.released_at.strftime("%B %d, %Y %I:%M %p") if product.released_at %></td>
        <td class="text-right"><%= product.discount %></td>
        <td class="text-nowrap"><%= product.created_at.strftime("%B %d, %Y %I:%M %p") %></td>
        <td class="d-flex gap-2">
          <%= link_to 'Show', product_path(product), class: 'btn btn-sm btn-primary', type: 'button' %>
          <%= link_to 'Edit', edit_product_path(product), class: 'btn btn-sm btn-warning', type: 'button' %>
          <%= button_to 'Delete', product_path(product), method: :delete, form: { data: { turbo_confirm: 'Are you sure?' } },
                        class: 'btn btn-sm btn-danger', type: 'button' %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
  <%= paginate @products %>
</div>
